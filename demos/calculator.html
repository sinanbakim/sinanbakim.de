<!DOCTYPE html>
<html lang="de">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Wissenschaftlicher Taschenrechner</title>
		<style>
			* {
				margin: 0;
				padding: 0;
				box-sizing: border-box;
			}

			body {
				background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f0f1a 100%);
				color: #e0e0e0;
				font-family: 'Courier New', monospace;
				min-height: 100vh;
				display: flex;
				align-items: center;
				justify-content: center;
				padding: 20px;
			}

			.calculator {
				background: rgba(30, 30, 30, 0.95);
				border: 2px solid #bb86fc;
				border-radius: 15px;
				padding: 25px;
				box-shadow: 0 0 30px rgba(187, 134, 252, 0.3), inset 0 0 20px rgba(0, 0, 0, 0.5);
				backdrop-filter: blur(10px);
				max-width: 400px;
				width: 100%;
			}

			.calculator-header {
				text-align: center;
				margin-bottom: 20px;
			}

			.calculator-title {
				color: #bb86fc;
				font-size: 1.5rem;
				font-weight: bold;
				text-shadow: 0 0 10px rgba(187, 134, 252, 0.5);
				margin-bottom: 5px;
			}

			.calculator-subtitle {
				color: #03dac6;
				font-size: 0.9rem;
				opacity: 0.8;
			}

			.display {
				background: #121212;
				border: 2px solid #333;
				border-radius: 8px;
				padding: 15px;
				margin-bottom: 20px;
				min-height: 80px;
				position: relative;
				overflow: hidden;
			}

			.display::before {
				content: '';
				position: absolute;
				top: 0;
				left: -100%;
				width: 100%;
				height: 100%;
				background: linear-gradient(90deg, transparent, rgba(187, 134, 252, 0.1), transparent);
				animation: scan 3s linear infinite;
			}

			@keyframes scan {
				0% {
					left: -100%;
				}
				100% {
					left: 100%;
				}
			}

			.expression {
				color: #bb86fc;
				font-size: 0.9rem;
				margin-bottom: 8px;
				min-height: 20px;
				word-break: break-all;
			}

			.result {
				color: #03dac6;
				font-size: 1.5rem;
				font-weight: bold;
				text-shadow: 0 0 5px rgba(3, 218, 198, 0.3);
				min-height: 30px;
			}

			.buttons {
				display: grid;
				grid-template-columns: repeat(5, 1fr);
				gap: 8px;
			}

			.btn {
				background: linear-gradient(145deg, #2a2a2a, #1a1a1a);
				border: 1px solid #444;
				border-radius: 8px;
				color: #e0e0e0;
				font-family: 'Courier New', monospace;
				font-size: 0.9rem;
				font-weight: bold;
				padding: 15px 8px;
				cursor: pointer;
				transition: all 0.2s ease;
				text-align: center;
				user-select: none;
			}

			.btn:hover {
				background: linear-gradient(145deg, #3a3a3a, #2a2a2a);
				box-shadow: 0 0 10px rgba(187, 134, 252, 0.3);
				transform: translateY(-1px);
			}

			.btn:active {
				transform: translateY(0);
				box-shadow: inset 0 2px 5px rgba(0, 0, 0, 0.3);
			}

			.btn.number {
				background: linear-gradient(145deg, #1e1e3e, #141428);
				border-color: #bb86fc;
				color: #bb86fc;
			}

			.btn.operator {
				background: linear-gradient(145deg, #2e1e2e, #1e141e);
				border-color: #ff6b9d;
				color: #ff6b9d;
			}

			.btn.function {
				background: linear-gradient(145deg, #1e2e1e, #141e14);
				border-color: #03dac6;
				color: #03dac6;
				font-size: 0.8rem;
			}

			.btn.equals {
				background: linear-gradient(145deg, #3e2e1e, #2e1e14);
				border-color: #ffa726;
				color: #ffa726;
				grid-column: span 2;
			}

			.btn.clear {
				background: linear-gradient(145deg, #3e1e1e, #2e1414);
				border-color: #f44336;
				color: #f44336;
			}

			.btn.wide {
				grid-column: span 2;
			}

			.memory-display {
				margin-top: 15px;
				padding: 10px;
				background: rgba(187, 134, 252, 0.1);
				border: 1px solid rgba(187, 134, 252, 0.3);
				border-radius: 5px;
				font-size: 0.8rem;
				color: #bb86fc;
				text-align: center;
			}

			.error {
				color: #f44336 !important;
				text-shadow: 0 0 5px rgba(244, 67, 54, 0.5);
			}

			/* Responsive Design */
			@media (max-width: 480px) {
				.calculator {
					padding: 15px;
					margin: 10px;
				}

				.btn {
					padding: 12px 6px;
					font-size: 0.8rem;
				}

				.calculator-title {
					font-size: 1.2rem;
				}
			}
		</style>
	</head>
	<body>
		<div class="calculator">
			<div class="calculator-header">
				<div class="calculator-title">SCI-CALC v2.1</div>
				<div class="calculator-subtitle">// Wissenschaftlicher Rechner //</div>
			</div>

			<div class="display">
				<div class="expression" id="expression"></div>
				<div class="result" id="result">0</div>
			</div>

			<div class="buttons">
				<!-- Row 1: Memory and Functions -->
				<button class="btn function" onclick="clearMemory()">MC</button>
				<button class="btn function" onclick="recallMemory()">MR</button>
				<button class="btn function" onclick="addToMemory()">M+</button>
				<button class="btn function" onclick="subtractFromMemory()">M-</button>
				<button class="btn clear" onclick="clearAll()">AC</button>

				<!-- Row 2: Advanced Functions -->
				<button class="btn function" onclick="insertFunction('sin(')">sin</button>
				<button class="btn function" onclick="insertFunction('cos(')">cos</button>
				<button class="btn function" onclick="insertFunction('tan(')">tan</button>
				<button class="btn function" onclick="insertFunction('log(')">log</button>
				<button class="btn function" onclick="insertFunction('ln(')">ln</button>

				<!-- Row 3: More Functions -->
				<button class="btn function" onclick="insertFunction('sqrt(')">√</button>
				<button class="btn function" onclick="insertOperator('^')">x^y</button>
				<button class="btn function" onclick="insertFunction('abs(')">|x|</button>
				<button class="btn operator" onclick="insertOperator('(')">(</button>
				<button class="btn operator" onclick="insertOperator(')')">)</button>

				<!-- Row 4: Numbers and Operators -->
				<button class="btn clear" onclick="clearEntry()">CE</button>
				<button class="btn operator" onclick="insertOperator('/')">/</button>
				<button class="btn operator" onclick="insertOperator('*')">×</button>
				<button class="btn operator" onclick="deleteLast()">⌫</button>
				<button class="btn function" onclick="insertConstant('pi')">π</button>

				<!-- Row 5 -->
				<button class="btn number" onclick="insertNumber('7')">7</button>
				<button class="btn number" onclick="insertNumber('8')">8</button>
				<button class="btn number" onclick="insertNumber('9')">9</button>
				<button class="btn operator" onclick="insertOperator('-')">-</button>
				<button class="btn function" onclick="insertConstant('e')">e</button>

				<!-- Row 6 -->
				<button class="btn number" onclick="insertNumber('4')">4</button>
				<button class="btn number" onclick="insertNumber('5')">5</button>
				<button class="btn number" onclick="insertNumber('6')">6</button>
				<button class="btn operator" onclick="insertOperator('+')">+</button>
				<button class="btn function" onclick="insertFunction('!')">n!</button>

				<!-- Row 7 -->
				<button class="btn number" onclick="insertNumber('1')">1</button>
				<button class="btn number" onclick="insertNumber('2')">2</button>
				<button class="btn number" onclick="insertNumber('3')">3</button>
				<button class="btn number" onclick="insertNumber('0')" rowspan="2">0</button>
				<button class="btn function" onclick="toggleSign()">±</button>

				<!-- Row 8 -->
				<button class="btn operator" onclick="insertOperator('.')">.</button>
				<button class="btn function" onclick="insertFunction('1/')">1/x</button>
				<button class="btn equals wide" onclick="calculate()">=</button>
			</div>

			<div class="memory-display" id="memoryDisplay">Memory: 0</div>
		</div>

		<script>
			let currentExpression = '';
			let currentResult = '0';
			let memory = 0;
			let lastResult = 0;
			let shouldResetOnNextInput = false;

			const expressionElement = document.getElementById('expression');
			const resultElement = document.getElementById('result');
			const memoryElement = document.getElementById('memoryDisplay');

			function updateDisplay() {
				expressionElement.textContent = currentExpression;
				resultElement.textContent = currentResult;
				memoryElement.textContent = `Memory: ${memory}`;
			}

			function insertNumber(num) {
				if (shouldResetOnNextInput) {
					currentExpression = '';
					shouldResetOnNextInput = false;
				}
				currentExpression += num;
				updateDisplay();
			}

			function insertOperator(op) {
				if (shouldResetOnNextInput) {
					currentExpression = currentResult;
					shouldResetOnNextInput = false;
				}

				// Spezielle Behandlung für Punkt
				if (op === '.') {
					if (currentExpression === '' || /[+\-*/^(]$/.test(currentExpression)) {
						currentExpression += '0.';
					} else if (!currentExpression.includes('.') || /[+\-*/^(]/.test(currentExpression.slice(currentExpression.lastIndexOf('.') + 1))) {
						currentExpression += '.';
					}
				} else {
					currentExpression += op;
				}
				updateDisplay();
			}

			function insertFunction(func) {
				if (shouldResetOnNextInput) {
					currentExpression = '';
					shouldResetOnNextInput = false;
				}

				if (func === '!') {
					currentExpression += '!';
				} else if (func === '1/') {
					currentExpression = `1/(${currentExpression || currentResult})`;
				} else {
					currentExpression += func;
				}
				updateDisplay();
			}

			function insertConstant(constant) {
				if (shouldResetOnNextInput) {
					currentExpression = '';
					shouldResetOnNextInput = false;
				}

				if (constant === 'pi') {
					currentExpression += 'π';
				} else if (constant === 'e') {
					currentExpression += 'e';
				}
				updateDisplay();
			}

			function deleteLast() {
				currentExpression = currentExpression.slice(0, -1);
				updateDisplay();
			}

			function clearEntry() {
				currentExpression = '';
				updateDisplay();
			}

			function clearAll() {
				currentExpression = '';
				currentResult = '0';
				updateDisplay();
			}

			function toggleSign() {
				if (currentExpression) {
					if (currentExpression.startsWith('-')) {
						currentExpression = currentExpression.slice(1);
					} else {
						currentExpression = '-' + currentExpression;
					}
				} else if (currentResult !== '0') {
					currentResult = (parseFloat(currentResult) * -1).toString();
				}
				updateDisplay();
			}

			// Memory Functions
			function clearMemory() {
				memory = 0;
				updateDisplay();
			}

			function recallMemory() {
				currentExpression = memory.toString();
				updateDisplay();
			}

			function addToMemory() {
				memory += parseFloat(currentResult) || 0;
				updateDisplay();
			}

			function subtractFromMemory() {
				memory -= parseFloat(currentResult) || 0;
				updateDisplay();
			}

			function factorial(n) {
				if (n < 0) return NaN;
				if (n === 0 || n === 1) return 1;
				let result = 1;
				for (let i = 2; i <= n; i++) {
					result *= i;
				}
				return result;
			}

			function calculate() {
				if (!currentExpression) return;

				try {
					// Ersetze mathematische Symbole und Funktionen
					let expression = currentExpression
						.replace(/π/g, Math.PI)
						.replace(/e(?![0-9])/g, Math.E)
						.replace(/sin\(/g, 'Math.sin(')
						.replace(/cos\(/g, 'Math.cos(')
						.replace(/tan\(/g, 'Math.tan(')
						.replace(/log\(/g, 'Math.log10(')
						.replace(/ln\(/g, 'Math.log(')
						.replace(/sqrt\(/g, 'Math.sqrt(')
						.replace(/abs\(/g, 'Math.abs(')
						.replace(/\^/g, '**');

					// Behandle Fakultät
					while (expression.includes('!')) {
						expression = expression.replace(/(\d+(?:\.\d+)?)!/g, (match, num) => {
							return factorial(parseInt(num));
						});
					}

					// Sichere Auswertung
					const result = Function('"use strict"; return (' + expression + ')')();

					if (isNaN(result) || !isFinite(result)) {
						throw new Error('Ungültiges Ergebnis');
					}

					lastResult = result;
					currentResult = parseFloat(result.toPrecision(12)).toString();
					shouldResetOnNextInput = true;

					// Entferne Error-Klasse falls vorhanden
					resultElement.classList.remove('error');
				} catch (error) {
					currentResult = 'Error';
					resultElement.classList.add('error');
					shouldResetOnNextInput = true;
				}

				updateDisplay();
			}

			// Keyboard Support
			document.addEventListener('keydown', function (event) {
				const key = event.key;

				if (key >= '0' && key <= '9') {
					insertNumber(key);
				} else if (['+', '-', '*', '/', '.'].includes(key)) {
					insertOperator(key === '*' ? '*' : key);
				} else if (key === 'Enter' || key === '=') {
					calculate();
				} else if (key === 'Escape') {
					clearAll();
				} else if (key === 'Backspace') {
					deleteLast();
				} else if (key === '(') {
					insertOperator('(');
				} else if (key === ')') {
					insertOperator(')');
				}
			});

			// Initial display update
			updateDisplay();
		</script>
	</body>
</html>
